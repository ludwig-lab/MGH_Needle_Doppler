This code is given as an example as a supplement to the 2023 manuscript "Needle guidance with Doppler-tracked polarization-sensitive optical coherence tomography"
by Danielle J. Harper, Yongjoo Kim, Alejandra Gomez-Ramirez and Benjamin J. Vakoc.



It is not actively maintained, but users are welcome to contact Danielle J. Harper (djharper@mgh.harvard.edu) should they have any questions regarding the code.

"get_phase_diff.m" allows the calculation of phase difference from raw phase information obtained from an OCT interferogram.
"doppler_needle_vis.m" uses pre-stored phase differences generated by "get_phase_diff.m" and creates surface-referenced maps of intensity, phase retardation, and optic axis as the needle moves. 


# OCT Needle Probe Visualization Project

## Description
This project processes Optical Coherence Tomography (OCT) phase data from a needle probe to visualize the movement of the needle and create surface-referenced maps of intensity, phase retardation, and optic axis. The `get_phase_diff` script prepares the data which is then visualized using the `doppler_needle_vis` script.

## Workflow Overview
The processing pipeline involves preprocessing the raw OCT data to calculate phase differences and then using those calculations to visualize the needle's path through tissue.

### Preprocessing with `get_phase_diff`
- **Purpose**: Prepares phase difference data from the OCT probe.
- **Input**: `.mgh` files containing phase data.
- **Output**: Processed phase difference data used for visualization.

### Visualization with `doppler_needle_vis`
- **Purpose**: Creates a video visualization of needle movement and surface-referenced maps.
- **Input**: Processed phase difference data, averaged optical images.
- **Output**: A video file (`salmon_rr.avi`) showing the reconstructed needle movement.

## Detailed Steps

### 1. Initialization
- Clear the MATLAB workspace and set up file paths for scripts and data access.

### 2. Data Reading
- Load the intensity (`ii.mgh`), optical axis (`OAavg_salmon.tif`), and retardation (`rravg_salmon.tif`) files.
- Load the `totaldisr_salmon.mat` file, which contains distance data derived from Doppler measurements.

### 3. Visualization Execution (`doppler_needle_vis`)
- The script reads in the intensity image data and combines it with pre-processed distance information to construct a visualization.
- A video writer object is created to store the visualization output.
- The script iterates through the data, creating frames that are compiled into a video showing the needle's movement.

## Requirements
- MATLAB (R2023a or newer recommended)
- Image Processing Toolbox for MATLAB

## Usage
Run the scripts in the following order:
1. `get_phase_diff.m` for preprocessing.
2. `doppler_needle_vis.m` for visualization.

```matlab
% Execute in MATLAB
run('get_phase_diff.m');
run('doppler_needle_vis.m');
